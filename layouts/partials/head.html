<head>
  <meta charset="utf-8" />
  <title>
    {{ if eq .Site.Params.reversepagetitle true }}
      {{ with .Title }}{{ . }} |{{ end }}
      {{ .Site.Params.author }}
    {{ else }}
      {{ .Site.Params.author }}{{ with .Title }} | {{ . }}{{ end }}
    {{ end }}
  </title>

  <!-- Meta -->
  {{ hugo.Generator }}
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="{{ .Site.Params.author }}" />
  <meta name="description" content="{{ with .Params.description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}" />

  {{ if .Params.redirectUrl }}
    <meta http-equiv="refresh" content="1; url={{ .Params.redirectUrl }}" />
  {{ end }}

  {{ if .Site.Params.googleSiteVerify }}
    <meta name="google-site-verification" content="{{ .Site.Params.googleSiteVerify }}" />
  {{ end }}

  <!-- CSS -->
  {{ if eq .Site.Language.LanguageDirection "rtl" }}
    {{ with resources.Get "scss/anatole.rtl.scss" }}
      {{ $sass := . | resources.ExecuteAsTemplate "scss/main.rtl.scss" $ }}
      {{ $style := $sass | css.Sass | resources.Minify | resources.Fingerprint }}
      <link rel="stylesheet" href="{{ $style.RelPermalink }}" integrity="{{ $style.Data.Integrity }}" crossorigin="anonymous" type="text/css" />
    {{ end }}
  {{ else }}
    {{ with resources.Get "scss/anatole.scss" }}
      {{ $sass := . | resources.ExecuteAsTemplate "scss/main.scss" $ }}
      {{ $style := $sass | css.Sass | resources.Minify | resources.Fingerprint }}
      <link rel="stylesheet" href="{{ $style.RelPermalink }}" integrity="{{ $style.Data.Integrity }}" crossorigin="anonymous" type="text/css" />
    {{ end }}
  {{ end }}

  {{ with resources.Get "css/markupHighlight.css" }}
    {{ $highlight := . | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $highlight.RelPermalink }}" integrity="{{ $highlight.Data.Integrity }}" crossorigin="anonymous" />
  {{ end }}

  {{ range .Site.Params.customCss }}
    {{ with resources.Get . }}
      {{ $style := . | resources.Minify | resources.Fingerprint }}
      <link rel="stylesheet" href="{{ $style.RelPermalink }}" integrity="{{ $style.Data.Integrity }}" crossorigin="anonymous" media="screen" />
    {{ end }}
  {{ end }}

  {{ with resources.Get "fontawesome/css/fontawesome.min.css" }}
    {{ $fa := . | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $fa.RelPermalink }}" integrity="{{ $fa.Data.Integrity }}" crossorigin="anonymous" />
  {{ end }}

  {{ with resources.Get "fontawesome/css/solid.min.css" }}
    {{ $solid := . | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $solid.RelPermalink }}" integrity="{{ $solid.Data.Integrity }}" crossorigin="anonymous" />
  {{ end }}

  {{ with resources.Get "fontawesome/css/regular.min.css" }}
    {{ $regular := . | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $regular.RelPermalink }}" integrity="{{ $regular.Data.Integrity }}" crossorigin="anonymous" />
  {{ end }}

  {{ with resources.Get "fontawesome/css/brands.min.css" }}
    {{ $brands := . | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $brands.RelPermalink }}" integrity="{{ $brands.Data.Integrity }}" crossorigin="anonymous" />
  {{ end }}

  {{ if .Params.redirectUrl }}
    {{ with resources.Get "css/spinner.css" }}
      {{ $spinner := . | resources.Minify | resources.Fingerprint }}
      <link rel="stylesheet" href="{{ $spinner.RelPermalink }}" integrity="{{ $spinner.Data.Integrity }}" crossorigin="anonymous" />
    {{ end }}
  {{ end }}

  {{ if .Site.Params.googleFonts }}
    {{ $baseUrl := "https://fonts.googleapis.com/css2?family=" }}
    {{ $fontParam := delimit .Site.Params.googleFonts "&family=" }}
    {{ $url := printf "%s%s&display=swap" $baseUrl $fontParam }}
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="{{ $url }}" rel="stylesheet" />
  {{ end }}

  <!-- Favicons -->
  <link rel="shortcut icon" href="{{ .Site.Params.favicon | relURL }}favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="{{ .Site.Params.favicon | relURL }}apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="{{ .Site.Params.favicon | relURL }}favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="{{ .Site.Params.favicon | relURL }}favicon-16x16.png" />

  <link rel="canonical" href="{{ .Permalink }}" />

  <!-- License -->
  {{ with .Site.Params.license }}
    <link rel="license" href="{{ . }}" />
  {{ end }}

  <!-- RSS -->
  {{ with .OutputFormats.Get "rss" }}
    <link rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" href="{{ .RelPermalink }}" />
  {{ end }}

  <!-- JavaScript -->
  {{ with resources.Get "js/anatole-header.js" }}
    {{ $header := . | resources.Minify | resources.Fingerprint }}
    <script src="{{ $header.RelPermalink }}" integrity="{{ $header.Data.Integrity }}" crossorigin="anonymous"></script>
  {{ end }}

  {{ if not .Site.Params.disableThemeSwitcher }}
    {{ with resources.Get "js/anatole-theme-switcher.js" }}
      {{ $switcher := . | resources.Minify | resources.Fingerprint }}
      <script src="{{ $switcher.RelPermalink }}" integrity="{{ $switcher.Data.Integrity }}" crossorigin="anonymous"></script>
    {{ end }}
  {{ end }}

  {{- $jsList := slice -}}
  {{- range .Site.Params.customJs }}
    {{- if or (in . "http://") (in . "https://") }}
      <script src="{{ . }}"></script>
    {{- else }}
      {{ with resources.Get . }}
        {{ $jsList = $jsList | append . }}
      {{ end }}
    {{- end }}
  {{- end }}

  {{ if gt (len $jsList) 0 }}
    {{ $custom := $jsList | resources.Concat "js/custom.js" | resources.Minify | resources.Fingerprint }}
    <script src="{{ $custom.RelPermalink }}" integrity="{{ $custom.Data.Integrity }}" crossorigin="anonymous"></script>
  {{ end }}

  <!-- Analytics -->
  {{ if and hugo.IsProduction .Site.Params.plausibleAnalytics .Site.Params.plausibleAnalytics.domain }}
    {{ partial "analytics/plausible" . }}
  {{ end }}

  {{ if and hugo.IsProduction .Site.Params.umami.serverURL .Site.Params.umami.id }}
    {{ partial "analytics/umami" . }}
  {{ end }}

  {{ if and hugo.IsProduction .Site.Params.Matomo.instance .Site.Params.Matomo.siteId }}
    {{ partial "analytics/matomo" . }}
  {{ end }}

  {{ if and hugo.IsProduction .Site.Params.meta.pixelId }}
    {{ partial "analytics/meta.html" . }}
  {{ end }}

  <!-- Social Cards -->
  {{ template "_internal/twitter_cards.html" . }}
  {{ template "_internal/opengraph.html" . }}

  <!-- Schema.org -->
  {{ partial "schema.html" . }}
</head>
